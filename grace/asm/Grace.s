section .text
  global _main
  extern _fprintf
  extern _fopen
  extern _err

%define STRING 115,101,99,116,105,111,110,32,46,116,101,120,116,10,32,32,103,108,111,98,97,108,32,95,109,97,105,110,10,32,32,101,120,116,101,114,110,32,95,102,112,114,105,110,116,102,10,32,32,101,120,116,101,114,110,32,95,102,111,112,101,110,10,32,32,101,120,116,101,114,110,32,95,101,114,114,10,10,37,37,100,101,102,105,110,101,32,83,84,82,73,78,71,32,37,115,10,37,37,100,101,102,105,110,101,32,65,83,95,83,84,82,73,78,71,40,38,120,41,32,120,10,10,37,37,109,97,99,114,111,32,68,69,67,76,95,70,85,78,67,32,49,10,32,32,37,37,49,58,32,32,32,32,10,32,32,32,32,108,101,97,32,114,100,105,44,32,91,114,101,108,32,111,117,116,102,105,108,101,110,97,109,101,93,10,32,32,32,32,108,101,97,32,114,115,105,44,32,91,114,101,108,32,102,108,97,103,95,119,114,105,116,101,95,111,110,108,121,93,10,32,32,32,32,99,97,108,108,32,95,102,111,112,101,110,10,32,32,32,32,99,109,112,32,114,97,120,44,32,48,10,32,32,32,32,106,110,101,32,111,112,101,110,95,115,117,99,99,101,115,115,10,32,32,32,32,109,111,118,32,101,100,105,44,32,49,10,32,32,32,32,108,101,97,32,114,115,105,44,32,91,114,101,108,32,102,111,112,101,110,93,10,32,32,32,32,99,97,108,108,32,95,101,114,114,10,32,32,111,112,101,110,95,115,117,99,99,101,115,115,58,10,32,32,32,32,112,117,115,104,32,114,98,120,10,32,32,32,32,109,111,118,32,114,100,105,44,32,114,97,120,10,32,32,32,32,108,101,97,32,114,115,105,44,32,91,114,101,108,32,109,115,103,93,10,32,32,32,32,108,101,97,32,114,100,120,44,32,91,114,101,108,32,109,101,116,97,109,115,103,93,10,32,32,32,32,120,111,114,32,114,97,120,44,32,114,97,120,10,32,32,32,32,99,97,108,108,32,95,102,112,114,105,110,116,102,10,32,32,32,32,112,111,112,32,114,98,120,10,32,32,32,32,120,111,114,32,114,97,120,44,32,114,97,120,10,32,32,32,32,114,101,116,10,37,37,101,110,100,109,97,99,114,111,10,10,59,32,65,78,89,87,65,89,32,73,84,32,87,79,82,75,83,46,10,68,69,67,76,95,70,85,78,67,32,95,109,97,105,110,10,10,115,101,99,116,105,111,110,32,46,100,97,116,97,10,32,32,109,115,103,32,100,98,32,83,84,82,73,78,71,44,32,48,10,32,32,109,101,116,97,109,115,103,32,100,98,32,65,83,95,83,84,82,73,78,71,40,83,84,82,73,78,71,41,44,32,48,10,32,32,111,117,116,102,105,108,101,110,97,109,101,32,100,98,32,34,71,114,97,99,101,95,107,105,100,46,115,34,44,32,48,10,32,32,102,108,97,103,95,119,114,105,116,101,95,111,110,108,121,32,100,98,32,39,119,39,44,32,48,10,32,32,102,111,112,101,110,32,100,98,32,39,102,111,112,101,110,39,44,32,48
%define AS_STRING(&x) x

%macro DECL_FUNC 1
  %1:    
    lea rdi, [rel outfilename]
    lea rsi, [rel flag_write_only]
    call _fopen
    cmp rax, 0
    jne open_success
    mov edi, 1
    lea rsi, [rel fopen]
    call _err
  open_success:
    push rbx
    mov rdi, rax
    lea rsi, [rel msg]
    lea rdx, [rel metamsg]
    xor rax, rax
    call _fprintf
    pop rbx
    xor rax, rax
    ret
%endmacro

; ANYWAY IT WORKS.
DECL_FUNC _main

section .data
  msg db STRING, 0
  metamsg db AS_STRING(STRING), 0
  outfilename db "Grace_kid.s", 0
  flag_write_only db 'w', 0
  fopen db 'fopen', 0